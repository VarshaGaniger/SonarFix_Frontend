{
    "sourceFile": "src/pages/ScanStatus.jsx",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 1,
            "patches": [
                {
                    "date": 1772095959670,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1772104069000,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -26,26 +26,22 @@\n         const backendStatus = res.data.status;\r\n         setStatus(backendStatus);\r\n \r\n         // ================= COMPLETED =================\r\n-if (backendStatus === \"COMPLETED\") {\r\n-  setProgress(100);\r\n+        if (backendStatus === \"COMPLETED\") {\r\n+          setProgress(100);\r\n \r\n-  if (!redirectedRef.current) {\r\n-    redirectedRef.current = true;\r\n+          if (!redirectedRef.current) {\r\n+            redirectedRef.current = true;\r\n \r\n-    clearInterval(intervalRef.current);\r\n+            clearInterval(intervalRef.current);\r\n \r\n-    const projectKey = res.data.projectKey;   // ðŸ‘ˆ GET IT HERE\r\n+            setTimeout(() => {\r\n+              navigate(\"/dashboard\");   // or \"/issues\"\r\n+            }, 1500);\r\n+          }\r\n+        }\r\n \r\n-    setTimeout(() => {\r\n-      navigate(\"/issues\", { \r\n-        state: { projectKey }   // ðŸ‘ˆ PASS IT\r\n-      });\r\n-    }, 1500);\r\n-  }\r\n-}\r\n-\r\n         // ================= FAILED =================\r\n         else if (backendStatus === \"FAILED\") {\r\n           clearInterval(intervalRef.current);\r\n           alert(\"Scan Failed. Check backend logs.\");\r\n"
                }
            ],
            "date": 1772095959669,
            "name": "Commit-0",
            "content": "import React, { useState, useEffect, useRef } from \"react\";\r\nimport { Box, Typography, LinearProgress, Grid, Card, CardContent, Button } from \"@mui/material\";\r\nimport { XCircle, Code, ShieldAlert, FolderOpen } from \"lucide-react\";\r\nimport { useNavigate, useParams } from \"react-router-dom\";\r\nimport axios from \"axios\";\r\nimport \"./ScanStatus.css\";\r\n\r\nconst ScanStatus = () => {\r\n  const navigate = useNavigate();\r\n  const { scanId } = useParams();\r\n  const intervalRef = useRef(null);\r\n  const redirectedRef = useRef(false);\r\n\r\n  const [progress, setProgress] = useState(5);\r\n  const [status, setStatus] = useState(\"STARTING\");\r\n\r\n  // ðŸ”¥ Poll backend every 2 sec\r\n  useEffect(() => {\r\n    if (!scanId) return;\r\n\r\n    intervalRef.current = setInterval(async () => {\r\n      try {\r\n        const res = await axios.get(\r\n  `http://localhost:8080/api/scan/status/${scanId}`\r\n);\r\n        const backendStatus = res.data.status;\r\n        setStatus(backendStatus);\r\n\r\n        // ================= COMPLETED =================\r\nif (backendStatus === \"COMPLETED\") {\r\n  setProgress(100);\r\n\r\n  if (!redirectedRef.current) {\r\n    redirectedRef.current = true;\r\n\r\n    clearInterval(intervalRef.current);\r\n\r\n    const projectKey = res.data.projectKey;   // ðŸ‘ˆ GET IT HERE\r\n\r\n    setTimeout(() => {\r\n      navigate(\"/issues\", { \r\n        state: { projectKey }   // ðŸ‘ˆ PASS IT\r\n      });\r\n    }, 1500);\r\n  }\r\n}\r\n\r\n        // ================= FAILED =================\r\n        else if (backendStatus === \"FAILED\") {\r\n          clearInterval(intervalRef.current);\r\n          alert(\"Scan Failed. Check backend logs.\");\r\n        }\r\n\r\n        // ================= RUNNING =================\r\n        else {\r\n          setProgress((prev) => (prev < 95 ? prev + 3 : prev));\r\n        }\r\n\r\n      } catch (err) {\r\n        console.error(\"Status fetch error:\", err);\r\n      }\r\n    }, 2000);\r\n\r\n    return () => clearInterval(intervalRef.current);\r\n  }, [scanId, navigate]);\r\n\r\n  const handleCancel = () => {\r\n    clearInterval(intervalRef.current);\r\n    navigate(\"/dashboard\");\r\n  };\r\n\r\n  return (\r\n    <Box className=\"scan-status-page\">\r\n\r\n      <Typography variant=\"h4\" sx={{ fontWeight: 700 }}>\r\n        Scan In Progress\r\n      </Typography>\r\n\r\n      <Typography sx={{ mb: 3 }}>\r\n        Scan ID: <strong>{scanId}</strong>\r\n      </Typography>\r\n\r\n      <Typography variant=\"h2\" sx={{ textAlign: \"center\", fontWeight: 800 }}>\r\n        {progress}%\r\n      </Typography>\r\n\r\n      <LinearProgress\r\n        variant=\"determinate\"\r\n        value={progress}\r\n        sx={{ height: 8, borderRadius: 5, mb: 5 }}\r\n      />\r\n\r\n      <Typography sx={{ textAlign: \"center\", mb: 3 }}>\r\n        Status: <strong>{status}</strong>\r\n      </Typography>\r\n\r\n      {/* Metrics */}\r\n      <Grid container spacing={3}>\r\n        <Grid item xs={12} md={4}>\r\n          <Card>\r\n            <CardContent>\r\n              <FolderOpen size={22} />\r\n              <Typography>Files Scanned</Typography>\r\n              <Typography variant=\"h4\">1,240</Typography>\r\n            </CardContent>\r\n          </Card>\r\n        </Grid>\r\n\r\n        <Grid item xs={12} md={4}>\r\n          <Card>\r\n            <CardContent>\r\n              <Code size={22} />\r\n              <Typography>Lines of Code</Typography>\r\n              <Typography variant=\"h4\">85,402</Typography>\r\n            </CardContent>\r\n          </Card>\r\n        </Grid>\r\n\r\n        <Grid item xs={12} md={4}>\r\n          <Card>\r\n            <CardContent>\r\n              <ShieldAlert size={22} />\r\n              <Typography>Issues Found</Typography>\r\n              <Typography variant=\"h4\">12</Typography>\r\n            </CardContent>\r\n          </Card>\r\n        </Grid>\r\n      </Grid>\r\n\r\n      <Box sx={{ textAlign: \"center\", mt: 4 }}>\r\n        <Button\r\n          variant=\"outlined\"\r\n          startIcon={<XCircle size={18} />}\r\n          onClick={handleCancel}\r\n        >\r\n          Cancel Scan\r\n        </Button>\r\n      </Box>\r\n    </Box>\r\n  );\r\n};\r\n\r\nexport default ScanStatus;"
        }
    ]
}